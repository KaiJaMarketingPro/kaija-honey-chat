<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>GPT Playground – KaiJa Marketing!</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f5f5f5; }
    select, textarea, button, input { font-size: 1em; margin: 0.5em 0; width: 100%; }
    #output { white-space: pre-wrap; background: #fff; padding: 1em; border-radius: 8px; border: 1px solid #ccc; min-height: 120px; }
    #canva-link, .freepik-box { margin-top: 1em; display: block; font-size: 0.95em; color: #0073e6; text-decoration: underline; }
    .disclaimer { background: #fff5d1; border-left: 6px solid #ffcc00; padding: 1em; margin-bottom: 2em; font-size: 0.9em; }
    iframe { width: 100%; height: 600px; border: 1px solid #ccc; display: none; margin-top: 2rem; }
  </style>
  <script type="module">
    import { handleAccess } from './access-check.js';

    window.checkAccessAndStart = () => {
      const email = document.getElementById("email-input").value.trim();
      handleAccess(email, "honey-gpt-frame");
    };
  </script>
</head>
<body>
  <h2>🧪 KaiJa GPT Playground</h2>

  <div class="disclaimer">
    <strong>Hinweis zur Datensicherheit:</strong><br>
    Diese Testumgebung dient ausschließlich zur lokalen Evaluation einzelner GPT-Modelle im Rahmen von KaiJa Marketing!.<br>
    Es werden keine personenbezogenen Daten gespeichert oder analysiert.<br>
    <ul>
      <li>✅ DSGVO-konform bei <strong>lokaler Nutzung</strong> oder auf geschütztem Dev-Server</li>
      <li>⚠️ Nicht zur Live-Nutzerkommunikation ohne Opt-in verwenden</li>
      <li>🔒 Kein Tracking, kein Cookie, keine Log-Erhebung in diesem Playground</li>
    </ul>
    <em>→ Nur aktivieren, wenn du als Betreiber:in oder Tester:in volle Kontrolle über die Umgebung hast.</em>
  </div>

  <label for="email-input">Zugang via E-Mail verifizieren:</label>
  <input type="email" id="email-input" placeholder="name@domain.com" required>
  <button onclick="checkAccessAndStart()">🔐 Zugang prüfen</button>
  <p id="access-message" style="color:red;"></p>

  <iframe id="honey-gpt-frame" src="https://kaija-honey-chat.vercel.app"></iframe>

  <label for="gpt">Wähle einen GPT:</label>
  <select id="gpt">
    <option value="maerki-gpt">🧠 Märki GPT</option>
    <option value="kaija-gpt">📣 KaiJa GPT</option>
    <option value="honey-gpt">🐝 Honey GPT</option>
    <option value="homie-gpt">🎓 Homie GPT</option>
    <option value="kaivio-gpt">💼 KaiVio GPT</option>
    <option value="baschis-gpt">🤝 Baschi GPT</option>
    <option value="soulguide-gabriela-gpt">🌿 Gabriela GPT</option>
    <option value="soulsyncai-gpt">🌙 SoulSync AI</option>
    <option value="dailyjasmin-gpt">✨ DailyJasmin</option>
  </select>

  <label for="prompt">Prompt eingeben:</label>
  <textarea id="prompt" rows="5" placeholder="Schreib mir 3 Tipps für meine Preisstrategie…"></textarea>

  <button onclick="sendPrompt()">🚀 Anfrage senden</button>
  <button onclick="generateCanvaLink()">🎨 Canva Vorlage vorschlagen</button>
  <button onclick="fetchFreepikImages()">🔎 Bild mit Freepik finden</button>

  <h3>🧠 GPT Antwort</h3>
  <div id="output">Antwort erscheint hier…</div>
  <a id="canva-link" href="#" target="_blank" style="display:none;">➡️ Canva Vorlage öffnen</a>
  <div id="freepik-results"></div>

  <script>
    async function sendPrompt() {
      const gpt = document.getElementById('gpt').value;
      const prompt = document.getElementById('prompt').value;
      const output = document.getElementById('output');

      output.innerText = '⏳ Anfrage wird verarbeitet…';

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ gpt, messages: [{ role: 'user', content: prompt }] })
        });
        const data = await res.json();
        output.innerText = data?.choices?.[0]?.message?.content || '⚠️ Keine Antwort erhalten.';
      } catch (err) {
        output.innerText = '❌ Fehler: ' + err.message;
      }
    }

    async function generateCanvaLink() {
      const prompt = document.getElementById('prompt').value;
      const linkEl = document.getElementById('canva-link');
      linkEl.innerText = '⏳ Canva-Link wird generiert…';
      linkEl.style.display = 'block';

      try {
        const res = await fetch('/api/canva-download', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: 'presentation', query: prompt })
        });
        const data = await res.json();
        linkEl.href = data.templateSearchUrl;
        linkEl.innerText = '➡️ Canva Vorlage öffnen';
      } catch (err) {
        linkEl.innerText = '❌ Fehler beim Generieren des Canva-Links';
      }
    }

    async function fetchFreepikImages() {
      const prompt = document.getElementById('prompt').value;
      const container = document.getElementById('freepik-results');
      container.innerHTML = '⏳ Suche wird durchgeführt…';

      try {
        const res = await fetch('/api/freepik-search', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: prompt })
        });
        const data = await res.json();
        if (!data.images?.length) {
          container.innerText = '⚠️ Keine Bilder gefunden.';
          return;
        }
        container.innerHTML = data.images.map(img => `
          <div class="freepik-box">
            <p><strong>${img.title}</strong></p>
            <img src="${img.thumb}" alt="${img.title}" style="max-width:100%;border-radius:4px">
            <p><a href="${img.link}" target="_blank">Freepik-Link öffnen</a></p>
          </div>
        `).join('');
      } catch (err) {
        container.innerText = '❌ Fehler beim Laden der Freepik-Bilder: ' + err.message;
      }
    }
  </script>
</body>
</html>
