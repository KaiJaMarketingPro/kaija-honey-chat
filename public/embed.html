<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>360¬∞ Lifecycle Check ‚Äì M√§rki GPT</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 2em;
      background: #f7f8fa;
      color: #333;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 2em;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }
    h2 {
      font-size: 1.8em;
    }
    p {
      font-size: 1.1em;
      line-height: 1.6;
    }
    #chatOutput {
      margin-top: 2em;
      white-space: pre-wrap;
      background: #f0f0f0;
      padding: 1em;
      border-radius: 8px;
      min-height: 80px;
    }
    #error {
      color: red;
      margin-top: 1em;
      display: none;
    }
    #loading {
      color: #666;
      margin-top: 1em;
      display: none;
    }
    button {
      font-size: 1em;
      padding: 0.6em 1.2em;
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1em;
    }
    footer {
      font-size: 0.9em;
      margin-top: 3em;
      color: #777;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîç 360¬∞ Lifecycle Check ‚Äì powered by M√§rki GPT</h2>
    <p>
      In nur wenigen Minuten analysiert M√§rki GPT, wie <strong>automatisiert, skalierbar</strong> und
      <strong>margenstark</strong> dein IT-Business ist ‚Äì ganz ohne Registrierung, Tracking oder Cookie-Banner.
    </p>

    <button onclick="startCheck()">Lifecycle Check starten</button>

    <div id="loading">‚è≥ GPT antwortet...</div>
    <div id="error">‚ùå Fehler beim Kontakt mit GPT.</div>
    <div id="chatOutput"></div>

    <footer>
      Diese Anwendung nutzt Azure OpenAI (gehostet in der Schweiz).<br />
      Es werden keine personenbezogenen Daten gespeichert.<br />
      <a href="/datenschutz" target="_blank">Mehr zur Datenschutzerkl√§rung</a>
    </footer>
  </div>

  <script type="module">
    import { sendToMaerkiGPT } from './kaija-chat.js';

    console.log("‚úÖ kaija-chat.js eingebunden ‚Äì embed.html l√§uft");

    window.startCheck = async function () {
      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('error');
      const outputEl = document.getElementById('chatOutput');

      if (!loadingEl || !errorEl || !outputEl) {
        console.error('‚ùå HTML-Elemente nicht gefunden. embed.html IDs pr√ºfen.');
        return;
      }

      const prompt = "Lifecycle Check starten";

      loadingEl.style.display = 'block';
      errorEl.style.display = 'none';
      outputEl.innerText = '';

      console.log("üöÄ Sende an GPT:", prompt);
      try {
        const antwort = await sendToMaerkiGPT(prompt);
        loadingEl.style.display = 'none';

        if (antwort.startsWith('‚ùå')) {
          errorEl.style.display = 'block';
          outputEl.innerText = antwort;
        } else {
          errorEl.style.display = 'none';
          outputEl.innerText = antwort;
          outputEl.scrollIntoView({ behavior: "smooth" });
        }
      } catch (err) {
        loadingEl.style.display = 'none';
        errorEl.style.display = 'block';
        outputEl.innerText = '‚ùå GPT konnte nicht kontaktiert werden.';
        console.error("‚ùå GPT-Fehler:", err);
      }
    };
  </script>
</body>
</html>
