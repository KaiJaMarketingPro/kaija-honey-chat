name: üö® Smoke-Test mit E-Mail Alert via Make

on:
  schedule:
    - cron: '14 6 * * *'  # t√§glich um 06:14 CET
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    name: üîç /test pr√ºfen + E-Mail bei Fehler

    steps:
      - name: üß™ Smoke-Test
        id: test
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://gpt.kaija-marketing.pro/test)
          echo "HTTP_STATUS=$STATUS" >> $GITHUB_ENV
          if [ "$STATUS" -ne 200 ]; then
            echo "‚ùå Fehler ‚Äì Status $STATUS"
            exit 1
          else
            echo "‚úÖ /test OK (200)"
          fi

      - name: üìß Sende Nur-Text-E-Mail via Make Webhook
        if: failure()
        run: |
          curl -X POST https://hook.eu2.make.com/YOUR-MAKE-WEBHOOK-ID \
          -H "Content-Type: application/json" \
          -d '{
                "status": "'${{ env.HTTP_STATUS }}'",
                "timestamp": "'$(date -Iseconds)'",
                "source": "GitHub Smoke Test",
                "message": "üö® Honey GPT ist aktuell nicht erreichbar.\n\nDer automatische Smoke-Test aus GitHub hat eine Fehlerantwort erhalten:\n\nURL: https://gpt.kaija-marketing.pro/test\nHTTP Status: '${{ env.HTTP_STATUS }}'\nZeitstempel: '$(date -Iseconds)'\nQuelle: GitHub Smoke Test\n\nBitte pr√ºfe:\n‚Ä¢ GPT-Verf√ºgbarkeit\n‚Ä¢ Vercel Deployment\n‚Ä¢ DNS-Status\n\n--\nKaiJa Monitoring System\nAutomatischer Alert via GitHub + Make"
              }'
